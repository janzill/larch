.. currentmodule:: larch

===========================================================
21: MTC Non-Motorized Nested Mode Choice
===========================================================

.. testsetup:: *

	import larch
	import larch.examples
	import pandas
	pandas.set_option('display.max_columns',999)
	pandas.set_option('expand_frame_repr',False)
	pandas.set_option('precision',4)
	larch._doctest_mode_ = True
	
.. testcode::
	
	m = larch.example(17)

Model 21's nesting structure groups the non-motorized alternatives. (`pp. 176 <http://www.caee.utexas.edu/prof/Bhat/COURSES/LM_Draft_060131Final-060630.pdf>`_)

.. testcode::
	
	nonmotorized = m.graph.new_node(parameter='mu', children=[5,6], name='Nonmotorized')

.. testcode::
	
	m.ordering = (
		("CostbyInc","costbyincome", ),
		("TravelTime",".*time.*",".*dist.*", ),
		("Household","hhinc.*","vehbywrk.*", ),
		("Zonal","wkcbd.*","wkempden.*", ),
		("ASCs","ASC.*", ),
	)
	
.. doctest::
	:options: +ELLIPSIS, +NORMALIZE_WHITESPACE, +REPORT_NDIFF

	>>> m.load_data()
	>>> m.maximize_loglike(method='bhhh')
	â”£ ...Optimization terminated successfully...
	>>> m.loglike()
	-3443.554...
	
	>>> print(m.parameter_summary())
	                                   Value  Null Value
	Category   Parameter                                
	CostbyInc  costbyincome          -0.0519         0.0
	TravelTime motorized_time        -0.0199         0.0
	           nonmotorized_time     -0.0454         0.0
	           motorized_ovtbydist    -0.135         0.0
	Household  hhinc#4              -0.00534         0.0
	           hhinc#5              -0.00922         0.0
	           hhinc#6              -0.00560         0.0
	           vehbywrk_BIKE          -0.693         0.0
	           vehbywrk_SR            -0.317         0.0
	           vehbywrk_TRANSIT       -0.947         0.0
	           vehbywrk_WALK          -0.714         0.0
	Zonal      wkcbd_BIKE              0.414         0.0
	           wkcbd_SR2               0.260         0.0
	           wkcbd_SR3                1.07         0.0
	           wkcbd_TRANSIT            1.31         0.0
	           wkcbd_WALK              0.103         0.0
	           wkempden_BIKE         0.00219         0.0
	           wkempden_SR2          0.00158         0.0
	           wkempden_SR3          0.00226         0.0
	           wkempden_TRANSIT      0.00313         0.0
	           wkempden_WALK         0.00279         0.0
	ASCs       ASC_BIKE                -1.45         0.0
	           ASC_SR2                 -1.81         0.0
	           ASC_SR3                 -3.43         0.0
	           ASC_TRANSIT            -0.682         0.0
	           ASC_WALK               0.0788         0.0
	Other      mu                      0.766         1.0